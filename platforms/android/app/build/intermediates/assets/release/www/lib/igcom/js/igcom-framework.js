var igcomFramework=angular.module("igcom-framework",[]);igcomFramework.controller("paginatorController",["$scope",function($scope){$scope.isVisible=!1,$scope.pageSizeList=[10,20,30,40,50,60,70,80,100,1e3],$scope.paginationSummary=null,$scope.countAll=0,$scope.pageSize=0,$scope.actualPage=1,$scope.setLastPage=function(){$scope.canSetLastPage()&&($scope.startRowIndex=$scope.countAll-$scope.pageSize,$scope.maxRowIndex=$scope.pageSize,$scope.fetchItemsCallback(),$scope.countItemsCallback().then(function(response){$scope.countAll=response.itemsLength,$scope.paginationSummary=$scope.buildSummary()}),$scope.actualPage=Math.ceil($scope.countAll/$scope.pageSize))},$scope.canSetLastPage=function(){return 0<$scope.countAll&&$scope.pageSize*$scope.actualPage<$scope.countAll},$scope.setFirstPage=function(){$scope.canSetFirstPage()&&($scope.startRowIndex=0,$scope.maxRowIndex=pageSize,$scope.fetchItemsCallback(),$scope.countItemsCallback().then(function(response){$scope.countAll=response.itemsLength,$scope.paginationSummary=$scope.buildSummary()}),$scope.actualPage=1)},$scope.canSetFirstPage=function(){return 0<$scope.countAll||1!==$scope.actualPage},$scope.setNextPage=function(){$scope.canSetNextPage()&&($scope.startRowIndex=$scope.startRowIndex+$scope.pageSize,$scope.maxRowIndex=$scope.pageSize,$scope.fetchItemsCallback(),$scope.countItemsCallback().then(function(response){$scope.countAll=response.itemsLength,$scope.paginationSummary=$scope.buildSummary()}),$scope.actualPage=$scope.actualPage+1)},$scope.canSetNextPage=function(){return 0<$scope.countAll&&$scope.pageSize*$scope.actualPage<$scope.countAll},$scope.setPreviousPage=function(){$scope.canSetPreviousPage()&&($scope.startRowIndex-$scope.pageSize<0?$scope.startRowIndex=0:$scope.startRowIndex=$scope.startRowIndex-$scope.pageSize,$scope.maxRowIndex=$scope.pageSize,fetchItemsCallback(),$scope.countItemsCallback().then(function(response){$scope.countAll=response.itemsLength,$scope.paginationSummary=$scope.buildSummary()}),$scope.actualPage=$scope.actualPage-1)},$scope.canSetPreviousPage=function(){return 0<$scope.countAll&&1!==$scope.actualPage},$scope.setPaginatorSize=function(size){$scope.pageSize=size,$scope.resetPaginatorIndexs(),$scope.fetchItemsCallback()},$scope.buildSummary=function(){return $scope.startRowIndex+$scope.pageSize>$scope.countAll?"Elementi: "+($scope.startRowIndex+1)+"-"+$scope.countAll+" di "+$scope.countAll:"Elementi: "+($scope.startRowIndex+1)+"-"+($scope.startRowIndex+$scope.pageSize)+" di "+$scope.countAll},$scope.actualPageSummary=function(){return"Pagina: "+$scope.actualPage+" di "+Math.ceil($scope.countAll/$scope.pageSize)},$scope.refresh=function(){$scope.fetchItemsCallback(),$scope.countItemsCallback().then(function(response){$scope.countAll=response.itemsLength,$scope.paginationSummary=$scope.buildSummary()})},$scope.resetPaginatorIndexs=function(){$scope.startRowIndex=0,$scope.maxRowIndex=$scope.pageSize,$scope.actualPage=1,$scope.countItemsCallback().then(function(response){$scope.countAll=response.itemsLength,$scope.paginationSummary=$scope.buildSummary()})}}]),igcomFramework.factory("idleWatchDogService",["$interval","$document","$rootScope",function($interval,$document,$rootScope){var interval=null,idleTime=0,watchDogTimer=18e4,isEnabled=!1;function startInterval(){isEnabled&&(interval=$interval(function(){idleTime+=watchDogTimer,$rootScope.$broadcast("igcom-framework-on-idle"),$interval.cancel(interval),isEnabled=!1},watchDogTimer))}function timerLogic(){idleTime=0,$interval.cancel(interval),startInterval()}return angular.element($document).bind("mousemove",function(e){timerLogic()}),angular.element($document).bind("keypress",function(e){timerLogic()}),{enableIdleWatchDog:function(){isEnabled=!0,startInterval()},disableIdleWatchDog:function(){isEnabled=!1,$interval.cancel(interval)},isIdle:function(){return 0<idleTime},watchDogTimer:watchDogTimer}}]),igcomFramework.factory("codiceFiscaleService",function(){var factory={pad:function(number,width,pad){return pad=pad||"0",(number+="").length>=width?number:new Array(width-number.length+1).join(pad)+number},generateCodiceFiscale:function(options){var gender=(options=options||{}).gender?options.gender:this.gender(),first=options.first?options.first:this.first({gender:gender,nationality:"it"}),last=options.last?options.last:this.last({nationality:"it"}),birthday=options.birthday?options.birthday:this.birthday(),city=options.city?options.city:this.pickone(["A","B","C","D","E","F","G","H","I","L","M","Z"])+factory.pad(this.natural({max:999}),3),cf=[],name_generator=function(name,isLast){var temp,return_value=[];return name.length<3?return_value=name.split("").concat("XXX".split("")).splice(0,3):(3<(temp=name.toUpperCase().split("").map(function(c){return-1!=="BCDFGHJKLMNPRSTVWZ".indexOf(c)?c:void 0}).join("")).length&&(temp=isLast?temp.substr(0,3):temp[0]+temp.substr(2,2)),temp.length<3&&(return_value=temp,temp=name.toUpperCase().split("").map(function(c){return-1!=="AEIOU".indexOf(c)?c:void 0}).join("").substr(0,3-return_value.length)),return_value+=temp),return_value};return cf=cf.concat(name_generator(last,!0),name_generator(first),function(birthday,gender,that){return birthday.getFullYear().toString().substr(2)+["A","B","C","D","E","H","L","M","P","R","S","T"][birthday.getMonth()]+factory.pad(birthday.getDate()+(2===gender?40:0),2)}(birthday,gender),city.toUpperCase().split("")).join(""),(cf+=function(cf){for(var range1="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",range2="ABCDEFGpaHIJABCDEFGHIJKLMNOPQRSTUVWXYZ",evens="ABCDEFGHIJKLMNOPQRSTUVWXYZ",digit=0,i=0;i<15;i++)digit+=i%2!=0?evens.indexOf(range2[range1.indexOf(cf[i])]):"BAKPLCQDREVOSFTGUHMINJWZYX".indexOf(range2[range1.indexOf(cf[i])]);return evens[digit%26]}(cf.toUpperCase())).toUpperCase()}};return factory}),igcomFramework.factory("paginatorService",function(){var maxRowIndexDefault=50;return{paginatorModel:function(maxRowIndexParam,maxSizeParam){return{currentPage:1,totalItems:0,maxRowIndex:maxRowIndexParam||maxRowIndexDefault,startRowIndex:0,maxSize:maxSizeParam||5,summary:"",isVisible:!1}},buildSummary:function(startRowIndex,maxRowIndex,totalItems){return totalItems<startRowIndex+maxRowIndex?"Elementi: "+(startRowIndex+1)+"-"+totalItems+" di "+totalItems:"Elementi: "+(startRowIndex+1)+"-"+(startRowIndex+totalItems)+" di "+totalItems},updateIndexs:function(totalItems,currentPage,startRowIndex,maxRowIndex){return Math.ceil(maxRowIndex*currentPage-maxRowIndex)},show:function(paginator){paginator.isVisible=!0},hide:function(paginator){paginator.isVisible=!1},maxRowIndexDefault:maxRowIndexDefault,setMaxRowIndex:function(max){maxRowIndexDefault=max}}}),igcomFramework.factory("responseDispatcherService",["$log",function($log){var isValidationResult=function(vResult){try{return vResult instanceof Array?null!=vResult[0].ErrorMessage||null!=vResult[0].errorMessage:null!=vResult.ErrorMessage||null!=vResult.errorMessage}catch(ex){return!1}},isOperationResult=function(vResult){try{return null!=vResult.ValidationResults||null!=vResult.ReturnedValue||null!=vResult.validationResults||null!=vResult.returnedValue}catch(ex){return!1}},isString=function(vResult){try{return angular.isString(vResult)}catch(ex){return!1}},printvalidationresult=function(results){var message="";return angular.forEach(results,function(value,index){var errorMessage=value.errorMessage||value.ErrorMessage;0===index?message+=errorMessage:message=message+"<br/>"+value}),message};return{isValidationResult:isValidationResult,isOperationResult:isOperationResult,isString:isString,printErrorMessages:function(vResults,toastr){if(!toastr)throw Error("Toastr is null!");angular.forEach(vResults,function(value){isValidationResult(value)?toastr.error(printvalidationresult(value)):isOperationResult(value)?toastr.error(printvalidationresult(value.ValidationResults)):isString(value)&&toastr.error(value)})},getErrorMessagesArray:function(vResults){var errorMessages=[];return angular.forEach(vResults,function(value){isValidationResult(value)?errorMessages.push(printvalidationresult(value)):isOperationResult(value)?errorMessages.push(printvalidationresult(value.ValidationResults)):isString(value)&&errorMessages.push(value)}),errorMessages},getErrorMessagesHtml:function(vResults){var errorMessages="";return angular.forEach(vResults,function(value){isValidationResult(value)?errorMessages+=printvalidationresult(value):isOperationResult(value)?errorMessages+=printvalidationresult(value.ValidationResults):isString(value)&&(errorMessages+=printvalidationresult(value)),errorMessages+="<br>"}),errorMessages}}}]),igcomFramework.factory("mockService",["$log","$q",function($log,$q){var delay=1e3;return{setDelay:function(milliseconds){delay=milliseconds},mockServerRequest:function(requestMethod,requestArgs,responseModel){var data=JSON.stringify(requestArgs);$log.info('[MOCK] Requesting server method "'+requestMethod+'" with parameters "'+data+'"...');var deferred=$q.defer();return setTimeout(function(){$log.info('[MOCK] Resolving server method "'+requestMethod+'"...'),deferred.resolve(responseModel),$log.info('[MOCK] Server method "'+requestMethod+'" resolved.')},delay),deferred.promise}}}]),igcomFramework.factory("httpService",["$http","$log","$q",function($http,$log,$q){return{httpRequest:function(url,method,data,headers,transformRequest,responseType){var request={method:method,url:url,headers:headers};transformRequest&&(request.transformRequest=transformRequest),"POST"===method||"PUT"===method?request.data=data:request.params=data,responseType&&(request.responseType=responseType);var deferred=$q.defer();return $http(request).then(function(responseData){$log.debug("Http request success: "+responseData),deferred.resolve(responseData)},function(responseData,status){$log.error("Http request error ("+status+"): "+responseData),deferred.reject({data:responseData,status:status})}),deferred.promise},httpJsonpRequest:function(url,query){var deferred=$q.defer();return $http.jsonp(url,{params:query}).then(function(response){$log.debug("Http request success: "+response),deferred.resolve(response)},function(response){$log.error("Http request error ("+status+"): "+response),deferred.reject(response)}),deferred.promise}}}]),igcomFramework.factory("dateService",[function(){var weekCount=function(year,monthNumber,dayStart){var firstOfMonth=new Date(year,monthNumber,dayStart||1),used=new Date(year,monthNumber,0).getDate()+firstOfMonth.getDate();return Math.ceil(used/7)},getMonth=function(date){return angular.isDate(date)||(date=new Date(date)),date.getMonth()};return{toString:function(dt){var datetime=dt instanceof Date?dt:toDateTime(dt);if(!datetime)return"";var d=datetime.getDate(),m=datetime.getMonth()+1;return(d<=9?"0"+d:d)+"-"+(m<=9?"0"+m:m)+"-"+datetime.getFullYear()},toStringWithHour:function(dt){var datetime=dt instanceof Date?dt:toDateTime(dt);if(!datetime)return"";var d=datetime.getDate(),m=datetime.getMonth()+1;return(d<=9?"0"+d:d)+"-"+(m<=9?"0"+m:m)+"-"+datetime.getFullYear()+"  "+datetime.getHours()+":"+datetime.getMinutes()},toDateTimeFromMvc:function(dateMvc){try{return new Date(parseInt(dateMvc.substr(6)))}catch(ex){return""}},addDays:function(oldDate,days){if(!(oldDate instanceof Date))throw Error("OldDate must be a Date javascript type");days||(days=0);var newDate=new Date(oldDate);return newDate.setDate(oldDate.getDate()+days),newDate},removeDays:function(oldDate,days){if(!(oldDate instanceof Date))throw Error("OldDate must be a Date javascript type");days||(days=0);var newDate=new Date(oldDate);return newDate.setDate(oldDate.getDate()-days),newDate},weekCount:weekCount,weekCountInRange:function(monthFirstDate,actualMonthNumber,yearNumber){angular.isDate(monthFirstDate)||(monthFirstDate=new Date(monthFirstDate));var monthFirst=getMonth(monthFirstDate),monthLast=monthFirst+actualMonthNumber,year=yearNumber||(new Date).getFullYear(),dayStart=monthFirstDate.getDate(),weekNumberCount=0;weekNumberCount+=weekCount(year,monthFirst,dayStart);for(var i=++monthFirst;i<monthLast;i++)weekNumberCount+=weekCount(year,i);return weekNumberCount},getMonth:getMonth,daysBetween:function(firstDate,secondDate){return firstDate=new Date(firstDate),secondDate=new Date(secondDate),Math.round(Math.abs((firstDate.getTime()-secondDate.getTime())/864e5))},getMonthWithPivot:function(date,pivot){angular.isDate(date)||(date=new Date(date)),pivot||(pivot=1);var actualMonth=date.getMonth();return new Date(date.getFullYear(),actualMonth+pivot)}}}]),igcomFramework.directive("fileUpload",[function(){return{scope:!0,link:function(scope,el,attrs){el.bind("change",function(event){for(var files=event.target.files,i=0;i<files.length;i++)scope.$emit("fileSelected",{file:files[i]})})}}}]),igcomFramework.directive("ngFocus",["$timeout",function($timeout){return{link:function(scope,element,attrs){scope.$watch(attrs.ngFocus,function(val){angular.isDefined(val)&&val&&$timeout(function(){element[0].focus()})},!0),element.bind("blur",function(){angular.isDefined(attrs.ngFocusLost)&&scope.$apply(attrs.ngFocusLost)})}}}]),igcomFramework.directive("igNumbersOnly",function(){return{require:"ngModel",link:function(scope,element,attrs,modelCtrl){modelCtrl.$parsers.push(function(inputValue){if(null==inputValue)return"";var transformedInput=inputValue.replace(/[^0-9]/g,"");return transformedInput!=inputValue&&(modelCtrl.$setViewValue(transformedInput),modelCtrl.$render()),transformedInput})}}}),igcomFramework.directive("passwordVerify",function(){return{require:"ngModel",scope:{passwordVerify:"="},link:function(scope,element,attrs,ctrl){scope.$watch(function(){var combined;return(scope.passwordVerify||ctrl.$viewValue)&&(combined=scope.passwordVerify+"_"+ctrl.$viewValue),combined},function(value){value&&ctrl.$parsers.unshift(function(viewValue){return scope.passwordVerify!==viewValue?void ctrl.$setValidity("passwordVerify",!1):(ctrl.$setValidity("passwordVerify",!0),viewValue)})})}}}),igcomFramework.directive("igUppercase",function(){return{require:"ngModel",link:function(scope,element,attrs,modelCtrl){var capitalize=function(inputValue){null==inputValue&&(inputValue="");var capitalized=inputValue.toUpperCase();return capitalized!==inputValue&&(modelCtrl.$setViewValue(capitalized),modelCtrl.$render()),capitalized};modelCtrl.$parsers.push(capitalize),capitalize(scope[attrs.ngModel])}}}),igcomFramework.provider("igOrderByService",[function(){var iconAscCssClass="fa fa-sort-asc",iconDescCssClass="fa fa-sort-desc",pointerCssClass="pointer";this.setEnvironment=function(ascCss,descCss,pointerCss){iconAscCssClass=ascCss,iconDescCssClass=descCss,pointerCssClass=pointerCss},this.$get=[function(){return new serviceBase}];var serviceBase=function(){this.orderType={asc:"asc",desc:"desc"},this.iconAscCssClass=iconAscCssClass,this.iconDescCssClass=iconDescCssClass,this.pointerCssClass=pointerCssClass,this.orderByModel=function(){return{property:"",propertyType:"",type:""}}}}]),igcomFramework.directive("igOrderBy",["$rootScope","$window","$timeout","igOrderByService","$compile",function($rootScope,$window,$timeout,igOrderByService,$compile){return{restrict:"AEC",scope:{property:"=",propertyType:"=",type:"=",fetch:"&"},link:function(scope,elem,attrs){var orderType=igOrderByService.orderType;elem.css({cursor:igOrderByService.pointerCssClass}),elem.bind("click",function(){try{switch(function(){var elements=elem.parent().children();if(elements){for(var elementsFiltered=[],i=0;i<=elements.length;i++){var element=elem.parent().children()[i];element&&element.hasAttribute("ig-order-by")&&elementsFiltered.push(element)}var icons=angular.element(elementsFiltered).find("i");angular.forEach(icons,function(value){value.remove()})}}(),attrs.type){case orderType.asc:var iconHtmlElement='<i class="'+igOrderByService.iconDescCssClass+'"></i>';elem.append(iconHtmlElement);break;case orderType.desc:iconHtmlElement='<i class="'+igOrderByService.iconAscCssClass+'"></i>',elem.append(iconHtmlElement)}switch(scope.$parent.model.orderBy.property=scope.property,scope.$parent.model.orderBy.propertyType=scope.propertyType,scope.$parent.model.orderBy.type=attrs.type,scope.$parent.model.orderBy.type){case orderType.asc:scope.$parent.model.orderBy.type=orderType.desc,attrs.type=orderType.desc,attrs.$set("type",attrs.type),$compile(elem)(scope);break;case orderType.desc:scope.$parent.model.orderBy.type=orderType.asc,attrs.type=orderType.asc,attrs.$set("type",attrs.type),$compile(elem)(scope)}scope.fetch()}catch(ex){}}),scope.$on("$destroy",function(){})}}}]),igcomFramework.directive("mbInfiniteScroll",["$rootScope","$window","$timeout",function($rootScope,$window,$timeout){return{link:function(scope,elem,attrs){var checkWhenEnabled,handler,scrollDistance,scrollEnabled;attrs.mbInfiniteScrollVariablesToWatch,attrs.mbInfiniteScrollResetPivot,attrs.mbInfiniteScrollElements;return $window=angular.element($window),scrollDistance=0,null!=attrs.mbInfiniteScrollDistance&&scope.$watch(attrs.mbInfiniteScrollDistance,function(value){return scrollDistance=parseInt(value,10)}),checkWhenEnabled=!(scrollEnabled=!0),null!=attrs.mbInfiniteScrollDisabled&&scope.$watch(attrs.mbInfiniteScrollDisabled,function(value){if((scrollEnabled=!value)&&checkWhenEnabled)return checkWhenEnabled=!1,handler()}),handler=function(){var shouldScroll,windowBottom;return windowBottom=$window.height()+$window.scrollTop(),(shouldScroll=elem.offset().top+elem.height()-windowBottom<=$window.height()*scrollDistance)&&scrollEnabled?$rootScope.$$phase?scope.$eval(attrs.mbInfiniteScroll):scope.$apply(attrs.mbInfiniteScroll):shouldScroll?checkWhenEnabled=!0:void 0},$window.on("scroll",handler),scope.$on("$destroy",function(){return $window.off("scroll",handler)}),$timeout(function(){return attrs.mbInfiniteScrollImmediateCheck?scope.$eval(attrs.mbInfiniteScrollImmediateCheck)?handler():void 0:handler()},0)}}}]);